<!DOCTYPE HTML>
<html lang="null">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="五年C++程序员的口水博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="https://israel-liu.github.io">
    <!--SEO-->





<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>Windows via C/C++ | 五年C++程序员的口水博客</title>


    <link rel="alternate" href="/atom.xml" title="五年C++程序员的口水博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>






    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(https://github.com/israel-Liu/theForger/raw/master/images/byosoku.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='Licca Chen'>
            <img src="/img/avatar.JPG" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
    	</div>
    </div>
</header>

    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="https://israel-liu.github.io">五年C++程序员的口水博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>Home</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>timeline</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/"><i class="fa "></i>Tags</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/about/"><i class="fa "></i>About</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>

    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Windows via C/C++">
            
	            Windows via C/C++
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/ ">
             
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/12/14</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h3 id="Chapter-3-内核对象"><a href="#Chapter-3-内核对象" class="headerlink" title="Chapter 3 : 内核对象"></a>Chapter 3 : 内核对象</h3><p>内核对象与创建它的进程相关联，进程句柄表里面保存地址。跨进程边界共享内核对象，还需要一种IPC把对象传递过去？还是传递的进程对象。</p>
<h3 id="第二部分-工作机理"><a href="#第二部分-工作机理" class="headerlink" title="第二部分 工作机理"></a>第二部分 工作机理</h3><h3 id="Chapter-4-进程"><a href="#Chapter-4-进程" class="headerlink" title="Chapter 4 : 进程"></a>Chapter 4 : <a href="https://docs.microsoft.com/en-us/windows/desktop/procthread/processes-and-threads" target="_blank" rel="noopener">进程</a></h3><p>我们的应用程序应该是系统 explorer 调用了 CreateProcess 函数创建了进程。ShellExecuteEx 是不是也通过 explorer 调用了 CreateProces ？<br>There are other techniques you can use in the place of multithreading. <a href="https://docs.microsoft.com/en-ca/windows/desktop/psapi/process-status-helper" target="_blank" rel="noopener">Process Status API</a><br>The most significant of these are as follows: asynchronous input and output (I/O), I/O completion ports, asynchronous procedure calls (APC), and the ability to wait for multiple events.<br><a href="https://docs.microsoft.com/en-ca/windows/desktop/ToolHelp/tool-help-library" target="_blank" rel="noopener">Tool Help Library</a> 用来枚举所有进程。<br>CreateProcess 子进程指定App, 会从main函数开始执行？。<br><a href="https://docs.microsoft.com/en-ca/windows/desktop/Memory/file-mapping" target="_blank" rel="noopener">共享内存</a><br><a href="https://docs.microsoft.com/en-ca/windows/desktop/ipc/interprocess-communications" target="_blank" rel="noopener">IPC</a>  <a href="https://docs.microsoft.com/en-ca/windows/desktop/ipc/pipes" target="_blank" rel="noopener">Pipes</a><br>Do not terminate a process unless its threads are in known states.<br>If a thread is waiting on a kernel object, it will not be terminated until the wait has completed.<br>This can cause the application to stop responding. (停止响应)</p>
<h3 id="Chapter-5-作业"><a href="#Chapter-5-作业" class="headerlink" title="Chapter 5 : 作业"></a>Chapter 5 : 作业</h3><p>可以用来停止相关联的进程。对进程设置限制条件。没细看，需要再看。<a href="https://docs.microsoft.com/en-ca/windows/desktop/ToolHelp/tool-help-library" target="_blank" rel="noopener">Tool Help Library</a></p>
<h3 id="Chapter-6-线程基础"><a href="#Chapter-6-线程基础" class="headerlink" title="Chapter 6 : 线程基础"></a>Chapter 6 : <a href="https://docs.microsoft.com/en-us/windows/desktop/procthread/processes-and-threads" target="_blank" rel="noopener">线程基础</a></h3><p>主线程入口点函数为crt运行库调用的main函数（名字可以自定义），工作线程入口点函数在创建的时候设置，为线程起始地址。从这个函数开始执行，到这个函数结束线程结束运行。<br>同一个进程中的线程可以访问其它线程的栈？虽然内存都是一块，堆栈什么的都是从同一个进程那分来的。什么技术访问别的线程的栈。tls干啥的来着。链接器的 /STACK 开关可以控制主线程默认栈大小。 </p>
<h3 id="Chapter-7-线程调度-优先级和关联性"><a href="#Chapter-7-线程调度-优先级和关联性" class="headerlink" title="Chapter 7 : 线程调度, 优先级和关联性"></a>Chapter 7 : 线程调度, 优先级和关联性</h3><p>进程优先级类下分线程优先级(The priority class and priority level are combined to form the base priority of a thread.)<br>Distinguish tasks of varying priority. For example, a high-priority thread manages time-critical tasks, and a low-priority thread performs other tasks.</p>
<h3 id="Chapter-8-用户模式下的线程同步"><a href="#Chapter-8-用户模式下的线程同步" class="headerlink" title="Chapter 8 : 用户模式下的线程同步"></a>Chapter 8 : <a href="https://docs.microsoft.com/en-gb/windows/desktop/Sync/synchronization" target="_blank" rel="noopener">用户模式下的线程同步</a></h3><p>有键事件类型的内核对象名叫 \KernelObjects\CritSecOutOfMemoryEvent 它的一个实例能够同步不同的线程组，每组由一个指针大小的key来标识和阻挡。<br>A single thread can initiate multiple time-consuming I/O requests that can run concurrently using asynchronous I/O. 单线程异步？借助系统线程。<br>管道可以和完成端口结合使用，管道用于IPC完成端口用于异步IO。这里需要使用线程同步？</p>
<h3 id="Chapter-9-用内核对象进行线程同步"><a href="#Chapter-9-用内核对象进行线程同步" class="headerlink" title="Chapter 9 : 用内核对象进行线程同步"></a>Chapter 9 : 用内核对象进行线程同步</h3><p>WaitForMultipleObjects只等待一个对象有信号的时候，再次调用的时候要去掉已经触发的句柄，防止立刻返回无法正常工作。<br>回调函数是调用线程调用后加入被调用线程的APC队列，由被调用线程执行的？是否立即响应<br>还是说回调函数不过是调用线程执行我模块的代码而已。我调用底层代码也是我的线程执行底层代码。<br>如果说各自执行代码，那什么时候出现交流的，难道是系统控制异步？</p>
<h3 id="Chapter-10-同步设备-I-O-与-异步设备-I-O"><a href="#Chapter-10-同步设备-I-O-与-异步设备-I-O" class="headerlink" title="Chapter 10 : 同步设备 I/O 与 异步设备 I/O"></a>Chapter 10 : 同步设备 I/O 与 异步设备 I/O</h3><p>OVERLAPPED对象要防止在设备驱动实际完成IO返回前被析构。在必须同步的地方调用等待函数。</p>
<h3 id="Chapter-11-Windows-线程池"><a href="#Chapter-11-Windows-线程池" class="headerlink" title="Chapter 11 : Windows 线程池"></a>Chapter 11 : Windows 线程池</h3><p>线程池就是一组帮助做事的线程，可以和很多功能结合工作，比如timer。</p>
<h3 id="Chapter-12-纤程"><a href="#Chapter-12-纤程" class="headerlink" title="Chapter 12 : 纤程"></a>Chapter 12 : 纤程</h3><p>主要是为了移植UNIX上的程序，因为他们单线程也可以多任务。Windows上的程序尽量用多线程。</p>
<h3 id="第三部分-内存管理"><a href="#第三部分-内存管理" class="headerlink" title="第三部分 内存管理"></a>第三部分 内存管理</h3><h3 id="Chapter-13-Windows-内存体系结构"><a href="#Chapter-13-Windows-内存体系结构" class="headerlink" title="Chapter 13 : Windows 内存体系结构"></a>Chapter 13 : Windows 内存体系结构</h3><p>空指针赋值区域 0x00000000 - 0x0000FFFF 就是NULL指向的区域？当用户地址大于2G的时候系统最多使用64G内存，使用默认2G的是最多使用128G内存？？？<br>内核模式分区为所有进程共有？那么物理内存如何映射，不同进程的线程同时访问，系统如何保证不出错。  ？？？<br>因为连接器对PE文件进行了压缩， 并且PE文件加载到内存的时候每段必须另起一页，起始地址必须是系统分页大小的整数倍，所以PE文件所需要的虚拟内存一般大于文件本身大小。<br>数据对齐？WORD类型应该是2的倍数？DWORD是4的倍数？字节和页大小4K有啥关系？这里各种大小完全搞晕掉了？</p>
<h3 id="Chapter-14-探索虚拟内存"><a href="#Chapter-14-探索虚拟内存" class="headerlink" title="Chapter 14 : 探索虚拟内存"></a>Chapter 14 : 探索虚拟内存</h3><p>非统一内存访问(Non-Uniform Memory Access) 简称 NUMA 看不懂干啥的？</p>
<h3 id="Chapter-15-在应用程序中使用虚拟内存"><a href="#Chapter-15-在应用程序中使用虚拟内存" class="headerlink" title="Chapter 15 : 在应用程序中使用虚拟内存"></a>Chapter 15 : 在应用程序中使用虚拟内存</h3><p>使用异常处理来选设备，初始化时候选择一次设备，后面直接使用如果返回错误再去选择设备。</p>
<h3 id="Chapter-16-线程栈"><a href="#Chapter-16-线程栈" class="headerlink" title="Chapter 16 : 线程栈"></a>Chapter 16 : 线程栈</h3><p>看的不够仔细，其实也没啥东西，就是个分配大小和溢出。</p>
<h3 id="Chapter-17-内存映射文件"><a href="#Chapter-17-内存映射文件" class="headerlink" title="Chapter 17 : 内存映射文件"></a>Chapter 17 : 内存映射文件</h3><p>看完这本书后，学习编译原理，调试技术，网络知识，算法知识，最后是语言最新技术。期间注意实践，写写轮子刷刷题什么的。<br>PS : 英文要提高啊。</p>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">theForger</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2018/12/27/2018-year-end-summary/" class="pre-post btn btn-default" title='2018-year-end-summary'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">2018-year-end-summary</span>
        </a>
    
    
        <a href="/2018/11/14/Synchronization/" class="next-post btn btn-default" title='Synchronization'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Synchronization</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
  <script id="dsq-count-scr" src="https://israel-liu.disqus.com/count.js" async></script>


<script type="text/javascript">
  var disqus_config = function () {
    this.page.url = 'https://israel-liu.github.io/2018/12/14/Windows-Via-C-Cpp/';
    this.page.identifier = '2018/12/14/Windows-Via-C-Cpp/';
    this.page.title = 'Windows via C/C++';
  };
  var d = document, s = d.createElement('script');
  s.src = 'https://israel-liu.disqus.com/embed.js';
  s.setAttribute('data-timestamp', '' + +new Date());
  (d.head || d.body).appendChild(s);
</script>


	

    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-3-内核对象"><span class="toc-text">Chapter 3 : 内核对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二部分-工作机理"><span class="toc-text">第二部分 工作机理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-4-进程"><span class="toc-text">Chapter 4 : 进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-5-作业"><span class="toc-text">Chapter 5 : 作业</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-6-线程基础"><span class="toc-text">Chapter 6 : 线程基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-7-线程调度-优先级和关联性"><span class="toc-text">Chapter 7 : 线程调度, 优先级和关联性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-8-用户模式下的线程同步"><span class="toc-text">Chapter 8 : 用户模式下的线程同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-9-用内核对象进行线程同步"><span class="toc-text">Chapter 9 : 用内核对象进行线程同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-10-同步设备-I-O-与-异步设备-I-O"><span class="toc-text">Chapter 10 : 同步设备 I/O 与 异步设备 I/O</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-11-Windows-线程池"><span class="toc-text">Chapter 11 : Windows 线程池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-12-纤程"><span class="toc-text">Chapter 12 : 纤程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三部分-内存管理"><span class="toc-text">第三部分 内存管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-13-Windows-内存体系结构"><span class="toc-text">Chapter 13 : Windows 内存体系结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-14-探索虚拟内存"><span class="toc-text">Chapter 14 : 探索虚拟内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-15-在应用程序中使用虚拟内存"><span class="toc-text">Chapter 15 : 在应用程序中使用虚拟内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-16-线程栈"><span class="toc-text">Chapter 16 : 线程栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-17-内存映射文件"><span class="toc-text">Chapter 17 : 内存映射文件</span></a></li></ol>
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<!--<a id="toc-btn">
    <i class="fa fa-bars"></i>
</a>-->

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



	<script src="/js/search.js?rev=@@hash"></script>


<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>