<!DOCTYPE HTML>
<html lang="null">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="五年C++程序员的口水博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="https://israel-liu.github.io">
    <!--SEO-->





<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>Windows Internals | 五年C++程序员的口水博客</title>


    <link rel="alternate" href="/atom.xml" title="五年C++程序员的口水博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>






    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(https://github.com/israel-Liu/theForger/raw/master/images/byosoku.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='Licca Chen'>
            <img src="/img/avatar.JPG" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
    	</div>
    </div>
</header>

    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="https://israel-liu.github.io">五年C++程序员的口水博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>Home</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>timeline</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/tags/"><i class="fa "></i>Tags</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/about/"><i class="fa "></i>About</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>

    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Windows Internals">
            
	            Windows Internals
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/ ">
             
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2017/11/16</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h1 id="Chapter-1-Concepts-and-Tools-1"><a href="#Chapter-1-Concepts-and-Tools-1" class="headerlink" title="Chapter 1 Concepts and Tools 1"></a>Chapter 1 Concepts and Tools 1</h1><h2 id="Windows-Operating-System-Versions-1"><a href="#Windows-Operating-System-Versions-1" class="headerlink" title="Windows Operating System Versions. 1"></a>Windows Operating System Versions. 1</h2><h2 id="Foundation-Concepts-and-Terms-2"><a href="#Foundation-Concepts-and-Terms-2" class="headerlink" title="Foundation Concepts and Terms. 2"></a>Foundation Concepts and Terms. 2</h2><h3 id="Windows-API-2"><a href="#Windows-API-2" class="headerlink" title="Windows API. 2"></a>Windows API. 2</h3><p>Is the user-mode system programming interface to the Windows operating system family.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">■■ Base Services</span><br><span class="line">■■ Component Services</span><br><span class="line">■■ User Interface Services</span><br><span class="line">■■ Graphics and Multimedia Services</span><br><span class="line">■■ Messaging and Collaboration</span><br><span class="line">■■ Networking</span><br><span class="line">■■ Web Services</span><br></pre></td></tr></table></figure>
<h3 id="Services-Functions-and-Routines-4"><a href="#Services-Functions-and-Routines-4" class="headerlink" title="Services, Functions, and Routines. 4"></a>Services, Functions, and Routines. 4</h3><p>Note that nonexecutable .NET assemblies are compiled as DLLs but without any exported subroutines.<br>Instead, the CLR parses compiled metadata to access the corresponding types and members.</p>
<h3 id="Processes-Threads-and-Jobs-5"><a href="#Processes-Threads-and-Jobs-5" class="headerlink" title="Processes, Threads, and Jobs. 5"></a>Processes, Threads, and Jobs. 5</h3><p>A program is a static sequence of instructions,<br>whereas a process is a container for a set of resources used when executing the instance of the program.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 进程包括: (communication ports) 肯定是IPC用的。</span><br><span class="line">■■ A private virtual address space, which is a set of virtual memory addresses that the process can use</span><br><span class="line">■■ An executable program, which defines initial code and data and is mapped into the process’ virtual address space</span><br><span class="line">■■ A list of open handles to various system resources—such as semaphores, communication ports, and files—that are accessible to all threads in the process</span><br><span class="line">■■ A security context called an access token that identifies the user, security groups, privileges, </span><br><span class="line">   User Account Control (UAC) virtualization state, session, and limited user account state associated with the process</span><br><span class="line">■■ A unique identifier called a process ID (internally part of an identifier called a client ID)</span><br><span class="line">■■ At least one thread of execution (although an “empty” process is possible, it is not useful)</span><br></pre></td></tr></table></figure>
<p>The volatile registers, stacks, and private storage area are called the thread’s context.(Wow64GetThreadContext)<br>用户线程的 dedicated kernel-mode thread ？ 是一一对应的？用于用户态和内核态线程切换。</p>
<h3 id="Virtual-Memory-15"><a href="#Virtual-Memory-15" class="headerlink" title="Virtual Memory . 15"></a>Virtual Memory . 15</h3><p>系统内存管理可以把暂时不运行的虚拟内存map到磁盘上。用户无需关心物理内存和磁盘之间的内存转换。<br>From 0x00000000 through 0x7FFFFFFF(用户), the upper half, addresses 0x80000000 through 0xFFFFFFFF(系统)<br>Address Windowing Extension (AWE), which allows a 32-bit application to allocate up to 64 GB<br>of physical memory and then map views, or windows, into its 2-GB virtual address space.</p>
<h3 id="Kernel-Mode-vs-User-Mode-17"><a href="#Kernel-Mode-vs-User-Mode-17" class="headerlink" title="Kernel Mode vs. User Mode. 17"></a>Kernel Mode vs. User Mode. 17</h3><p>对 access to all system memory and all CPU instructions 权限不同。<br>x64, x86 共提供4个级别, Win内核模式工作在CPU级别 level 0 (or ring 0), 用户模式工作在 level 3 (or ring 3).<br>用户进程单享VM，the kernel-mode operating system and device driver code share a single virtual address space.<br>A transition from user mode to kernel mode (and back) does not affect thread scheduling per se—a mode transition is not a context switch.<br>都是同一个线程在运行？只是模式不同？</p>
<h3 id="Terminal-Services-and-Multiple-Sessions-20"><a href="#Terminal-Services-and-Multiple-Sessions-20" class="headerlink" title="Terminal Services and Multiple Sessions. 20"></a>Terminal Services and Multiple Sessions. 20</h3><p>切换用户后 the current session processes remains active in the system。</p>
<h3 id="Objects-and-Handles-21"><a href="#Objects-and-Handles-21" class="headerlink" title="Objects and Handles. 21"></a>Objects and Handles. 21</h3><p>系统提供对象管理器组件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">■■ Providing human-readable names for system resources</span><br><span class="line">■■ Sharing resources and data among processes</span><br><span class="line">■■ Protecting resources from unauthorized access</span><br><span class="line">■■ Reference tracking, which allows the system to know when an object is no longer in use so that it can be automatically deallocated</span><br></pre></td></tr></table></figure>
<p>handles (references to an instance of an object).</p>
<h3 id="Security-22"><a href="#Security-22" class="headerlink" title="Security . 22"></a>Security . 22</h3><p>非常重要，但是目前很少关心，都是系统默认行为。</p>
<h3 id="Registry-23"><a href="#Registry-23" class="headerlink" title="Registry . 23"></a>Registry . 23</h3><p>系统数据库，包括启动系统配置，和应用程序配置。</p>
<h3 id="Unicode-24"><a href="#Unicode-24" class="headerlink" title="Unicode. 24"></a>Unicode. 24</h3><p>Windows most internal text strings are stored and processed as 16-bit-wide Unicode characters.(所以使用宽字符API避免转换)</p>
<h2 id="Digging-into-Windows-Internals-24"><a href="#Digging-into-Windows-Internals-24" class="headerlink" title="Digging into Windows Internals. 24"></a>Digging into Windows Internals. 24</h2><h3 id="Performance-Monitor-25"><a href="#Performance-Monitor-25" class="headerlink" title="Performance Monitor. 25"></a>Performance Monitor. 25</h3><h3 id="Kernel-Debugging-26"><a href="#Kernel-Debugging-26" class="headerlink" title="Kernel Debugging. 26"></a>Kernel Debugging. 26</h3><p>Symbol files contain the names of functions and variables and the layout and format of data structures.</p>
<h3 id="Windows-Software-Development-Kit-31"><a href="#Windows-Software-Development-Kit-31" class="headerlink" title="Windows Software Development Kit. 31"></a>Windows Software Development Kit. 31</h3><p>现在vs已经不是使用单独的副本了，放到同一个位置。</p>
<h3 id="Windows-Driver-Kit-31"><a href="#Windows-Driver-Kit-31" class="headerlink" title="Windows Driver Kit . 31"></a>Windows Driver Kit . 31</h3><h3 id="Sysinternals-Tools-32"><a href="#Sysinternals-Tools-32" class="headerlink" title="Sysinternals Tools. 32"></a>Sysinternals Tools. 32</h3><h2 id="Conclusion-32"><a href="#Conclusion-32" class="headerlink" title="Conclusion. 32"></a>Conclusion. 32</h2><h1 id="Chapter-2-System-Architecture-33"><a href="#Chapter-2-System-Architecture-33" class="headerlink" title="Chapter 2 System Architecture 33"></a>Chapter 2 System Architecture 33</h1><h2 id="Requirements-and-Design-Goals-33"><a href="#Requirements-and-Design-Goals-33" class="headerlink" title="Requirements and Design Goals . 33"></a>Requirements and Design Goals . 33</h2><p>Extensibility, Portability, Reliability and robustness, Compatibility, Performance</p>
<h2 id="Operating-System-Model-34"><a href="#Operating-System-Model-34" class="headerlink" title="Operating System Model. 34"></a>Operating System Model. 34</h2><p>system support processes, service processes, user applications,<br>and environment subsystems each have their own private process address space.</p>
<h2 id="Architecture-Overview-35"><a href="#Architecture-Overview-35" class="headerlink" title="Architecture Overview. 35"></a>Architecture Overview. 35</h2><h3 id="Portability-37"><a href="#Portability-37" class="headerlink" title="Portability. 37"></a>Portability. 37</h3><p>分层设计，Ntoskrnl.exe architecture-specific 线程调度，HAL 用于剥离硬件。</p>
<h3 id="Symmetric-Multiprocessing-38"><a href="#Symmetric-Multiprocessing-38" class="headerlink" title="Symmetric Multiprocessing. 38"></a>Symmetric Multiprocessing. 38</h3><h3 id="Scalability-40"><a href="#Scalability-40" class="headerlink" title="Scalability. 40"></a>Scalability. 40</h3><h3 id="Differences-Between-Client-and-Server-Versions-41"><a href="#Differences-Between-Client-and-Server-Versions-41" class="headerlink" title="Differences Between Client and Server Versions. 41"></a>Differences Between Client and Server Versions. 41</h3><p>The number of processors supported (in terms of sockets, not cores or threads)。<br>The number of concurrent network connections supported。</p>
<h3 id="Checked-Build-45"><a href="#Checked-Build-45" class="headerlink" title="Checked Build. 45"></a>Checked Build. 45</h3><h2 id="Key-System-Components-46"><a href="#Key-System-Components-46" class="headerlink" title="Key System Components. 46"></a>Key System Components. 46</h2><h3 id="Environment-Subsystems-and-Subsystem-DLLs-48"><a href="#Environment-Subsystems-and-Subsystem-DLLs-48" class="headerlink" title="Environment Subsystems and Subsystem DLLs . 48"></a>Environment Subsystems and Subsystem DLLs . 48</h3><p><a href="http://www.dependencywalker.com/" target="_blank" rel="noopener">Depends.exe</a><br>POSIX “a portable operating system interface based on UNIX”</p>
<h3 id="Ntdll-dll-53"><a href="#Ntdll-dll-53" class="headerlink" title="Ntdll.dll. 53"></a>Ntdll.dll. 53</h3><p>Ntdll also contains many support functions start with (Ldr, Csr, Rtl, DbgUi, Etw …)</p>
<h3 id="Executive-54"><a href="#Executive-54" class="headerlink" title="Executive. 54"></a>Executive. 54</h3><p>The Windows executive is the upper layer of Ntoskrnl.exe(就是对应内核的Ntoskrnl.exe)</p>
<h3 id="Kernel-57"><a href="#Kernel-57" class="headerlink" title="Kernel. 57"></a>Kernel. 57</h3><p>!pcr and !prcb kernel debugger commands。</p>
<h3 id="Hardware-Abstraction-Layer-60"><a href="#Hardware-Abstraction-Layer-60" class="headerlink" title="Hardware Abstraction Layer. 60"></a>Hardware Abstraction Layer. 60</h3><p>lm vm hal, </p>
<h3 id="Device-Drivers-63"><a href="#Device-Drivers-63" class="headerlink" title="Device Drivers. 63"></a>Device Drivers. 63</h3><p>There are several types of device drivers:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">■■ Hardware device drivers manipulate hardware (using the HAL) to write output to or retrieve input</span><br><span class="line">   from a physical device or network. There are many types of hardware device drivers,</span><br><span class="line">   such as bus drivers, human interface drivers, mass storage drivers, and so on.</span><br><span class="line">■■ File system drivers are Windows drivers that accept file-oriented I/O requests and translate</span><br><span class="line">   them into I/O requests bound for a particular device.</span><br><span class="line">■■ File system filter drivers, such as those that perform disk mirroring and encryption,</span><br><span class="line">   intercept I/Os, and perform some added-value processing before passing the I/O to the next layer.</span><br><span class="line">■■ Network redirectors and servers are file system drivers that transmit file system I/O requests to</span><br><span class="line">   a machine on the network and receive such requests, respectively.</span><br><span class="line">■■ Protocol drivers implement a networking protocol such as TCP/IP, NetBEUI, and IPX/SPX.</span><br><span class="line">■■ Kernel streaming filter drivers are chained together to perform signal processing on data</span><br><span class="line">   streams, such as recording or displaying audio and video.</span><br></pre></td></tr></table></figure></p>
<pre><code>A bus driver is concerned with reporting the devices on its bus to the PnP manager,
A function driver manipulates the device.
Lower-level filter drivers modify the behavior of device hardware.
Upper-level filter drivers usually provide added-value features for a device.
&lt;Prefix&gt;&lt;Operation&gt;&lt;Object&gt;
</code></pre><h3 id="System-Processes-68"><a href="#System-Processes-68" class="headerlink" title="System Processes. 68"></a>System Processes. 68</h3><p>create system threads during system initialization to perform operations that require thread context.<br>The default SAS on Windows is the combination Ctrl+Alt+Delete.</p>
<h2 id="Conclusion-78"><a href="#Conclusion-78" class="headerlink" title="Conclusion. 78"></a>Conclusion. 78</h2><h1 id="Chapter-3-System-Mechanisms-79"><a href="#Chapter-3-System-Mechanisms-79" class="headerlink" title="Chapter 3 System Mechanisms 79"></a>Chapter 3 System Mechanisms 79</h1><p>Trap Dispatching. 79<br>Interrupt Dispatching . 81<br>Timer Processing. 112<br>Exception Dispatching. 123<br>System Service Dispatching. 132<br>Object Manager . 140<br>Executive Objects. 143<br>Object Structure. 145<br>Synchronization. 176<br>High-IRQL Synchronization. 178<br>Low-IRQL Synchronization. 183<br>System Worker Threads. 205<br>Windows Global Flags. 207<br>Advanced Local Procedure Call. 209<br>Connection Model. 210<br>Message Model . 211<br>Asynchronous Operation. 213<br>Views, Regions, and Sections. 214<br>Attributes. 215<br>Blobs, Handles, and Resources . 215<br>Security . 216<br>Performance. 217<br>Debugging and Tracing . 218<br>Kernel Event Tracing. 220<br>Wow64. 224<br>Wow64 Process Address Space Layout . 224<br>System Calls. 225<br>Exception Dispatching. 225<br>User APC Dispatching. 225<br>Console Support. 225<br>User Callbacks. 226<br>File System Redirection. 226<br>Registry Redirection . 227<br>I/O Control Requests. 227<br>16-Bit Installer Applications. 228<br>Printing. 228<br>Restrictions. 228<br>User-Mode Debugging. 229<br>Kernel Support. 229<br>Native Support. 230<br>Windows Subsystem Support . 232<br>Image Loader. 232<br>Early Process Initialization . 234<br>DLL Name Resolution and Redirection . 235<br>Loaded Module Database . 238<br>Import Parsing. 242<br>Post-Import Process Initialization. 243<br>SwitchBack. 244<br>API Sets . 245<br>Hypervisor (Hyper-V). 248<br>Partitions. 249<br>Parent Partition. 249<br>Child Partitions. 251<br>Hardware Emulation and Support . 254<br>Kernel Transaction Manager. 268<br>Hotpatch Support. 270<br>Kernel Patch Protection. 272<br>Code Integrity. 274<br>Conclusion. 276</p>
<h1 id="Chapter-4-Management-Mechanisms-277"><a href="#Chapter-4-Management-Mechanisms-277" class="headerlink" title="Chapter 4 Management Mechanisms 277"></a>Chapter 4 Management Mechanisms 277</h1><p>The Registry. 277<br>Viewing and Changing the Registry. 277<br>Registry Usage. 278<br>Registry Data Types. 279<br>Registry Logical Structure. 280<br>Transactional Registry (TxR). 287<br>Monitoring Registry Activity. 289<br>Process Monitor Internals. 289<br>Registry Internals. 293<br>Services. 305<br>Service Applications. 305<br>The Service Control Manager . 321<br>Service Startup. 323<br>Startup Errors. 327<br>Accepting the Boot and Last Known Good. 328<br>Service Failures. 330<br>Service Shutdown. 331<br>Shared Service Processes. 332<br>Service Tags. 335<br>Unified Background Process Manager. 336<br>Initialization. 337<br>UBPM API . 338<br>Provider Registration. 338<br>Consumer Registration. 339<br>Task Host. 341<br>Service Control Programs. 341<br>Windows Management Instrumentation. 342<br>Providers. 344<br>The Common Information Model and the Managed<br>Object Format Language. 345<br>Class Association . 349<br>WMI Implementation. 351<br>WMI Security. 353<br>Windows Diagnostic Infrastructure . 354<br>WDI Instrumentation. 354<br>Diagnostic Policy Service. 354<br>Diagnostic Functionality. 356<br>Conclusion. 357</p>
<h1 id="Chapter-5-Processes-Threads-and-Jobs-359"><a href="#Chapter-5-Processes-Threads-and-Jobs-359" class="headerlink" title="Chapter 5 Processes, Threads, and Jobs 359"></a>Chapter 5 Processes, Threads, and Jobs 359</h1><h2 id="Process-Internals-359"><a href="#Process-Internals-359" class="headerlink" title="Process Internals. 359"></a>Process Internals. 359</h2><h3 id="Data-Structures-359"><a href="#Data-Structures-359" class="headerlink" title="Data Structures. 359"></a>Data Structures. 359</h3><p>EPROCESS 关联的数据除了PEB在 process address space 大部分存在于 system address space.</p>
<h3 id="Protected-Processes-368"><a href="#Protected-Processes-368" class="headerlink" title="Protected Processes. 368"></a>Protected Processes. 368</h3><p>Flow of CreateProcess. 369<br>Stage 1: Converting and Validating Parameters and Flags. 371<br>Stage 2: Opening the Image to Be Executed . 373<br>Stage 3: Creating the Windows Executive Process<br>Object (PspAllocateProcess). 376<br>Stage 4: Creating the Initial Thread and Its Stack and<br>Context. 381<br>Stage 5: Performing Windows Subsystem–Specific<br>Post-Initialization. 383<br>Stage 6: Starting Execution of the Initial Thread. 385<br>Stage 7: Performing Process Initialization in the Context<br>of the New Process . 386<br>Thread Internals . 391<br>Data Structures. 391<br>Birth of a Thread . 398<br>Examining Thread Activity. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .398<br>Limitations on Protected Process Threads. 401<br>Worker Factories (Thread Pools) . 403<br>Thread Scheduling. 408<br>Overview of Windows Scheduling . 408<br>Priority Levels. 410<br>Thread States . 416<br>Dispatcher Database. 421<br>Quantum. 422<br>Priority Boosts. 430<br>Context Switching. 448<br>Scheduling Scenarios. 449<br>Idle Threads. 453<br>Thread Selection. 456<br>Multiprocessor Systems. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .458<br>Thread Selection on Multiprocessor Systems. 467<br>Processor Selection. 468<br>Processor Share-Based Scheduling. 470<br>Distributed Fair Share Scheduling. 471<br>CPU Rate Limits . 478<br>Dynamic Processor Addition and Replacement . 479<br>Job Objects . 480<br>Job Limits. 481<br>Job Sets. 482<br>Conclusion. 485</p>
<h1 id="Chapter-6-Security-487"><a href="#Chapter-6-Security-487" class="headerlink" title="Chapter 6 Security 487"></a>Chapter 6 Security 487</h1><p>Security Ratings. 487<br>Trusted Computer System Evaluation Criteria. . . . . . . . . . . . . . . . . .487<br>The Common Criteria. 489<br>Security System Components. 490<br>Protecting Objects. 494<br>Access Checks. 495<br>Security Identifiers. 497<br>Virtual Service Accounts. 518<br>Security Descriptors and Access Control. 522<br>The AuthZ API. 536<br>Account Rights and Privileges . 538<br>Account Rights. 540<br>Privileges. 540<br>Super Privileges . 546<br>Access Tokens of Processes and Threads. 547<br>Security Auditing. 548<br>Object Access Auditing. 549<br>Global Audit Policy . 552<br>Advanced Audit Policy Settings. 554<br>Logon. 555<br>Winlogon Initialization. 556<br>User Logon Steps. 558<br>Assured Authentication. 562<br>Biometric Framework for User Authentication. 563<br>User Account Control and Virtualization. 566<br>File System and Registry Virtualization. 566<br>Elevation . 573<br>Application Identification (AppID). 581<br>AppLocker . 583<br>Software Restriction Policies. 589<br>Conclusion. 590</p>
<h1 id="Chapter-7-Networking-591"><a href="#Chapter-7-Networking-591" class="headerlink" title="Chapter 7 Networking 591"></a>Chapter 7 Networking 591</h1><p>Windows Networking Architecture. 591<br>The OSI Reference Model. 592<br>Windows Networking Components. 594<br>Networking APIs. 597<br>Windows Sockets. 597<br>Winsock Kernel. 603<br>Remote Procedure Call. 605<br>Web Access APIs. 610<br>Named Pipes and Mailslots. 612<br>NetBIOS. 618<br>Other Networking APIs. 620<br>Multiple Redirector Support. 627<br>Multiple Provider Router . 627<br>Multiple UNC Provider. 630<br>Surrogate Providers. 632<br>Redirector. 633<br>Mini-Redirectors. 634<br>Server Message Block and Sub-Redirectors. 635<br>Distributed File System Namespace . 637<br>Distributed File System Replication. 638<br>Offline Files . 639<br>Caching Modes. 641<br>Ghosts . 643<br>Data Security. 643<br>Cache Structure . 643<br>BranchCache. 645<br>Caching Modes. 647<br>BranchCache Optimized Application Retrieval:<br>SMB Sequence. 651<br>BranchCache Optimized Application Retrieval:<br>HTTP Sequence. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .653<br>Name Resolution. 655<br>Domain Name System. 655<br>Peer Name Resolution Protocol. . . . . . . . . . . . . . . . . . . . . . . . . . . . . .656<br>Location and Topology. 658<br>Network Location Awareness . 658<br>Network Connectivity Status Indicator . 659<br>Link-Layer Topology Discovery. 662<br>Protocol Drivers. 663<br>Windows Filtering Platform. 666<br>NDIS Drivers. 672<br>Variations on the NDIS Miniport. 677<br>Connection-Oriented NDIS. 677<br>Remote NDIS. 680<br>QoS. 682<br>Binding. 684<br>Layered Network Services. 685<br>Remote Access. 685<br>Active Directory. 686<br>Network Load Balancing. 688<br>Network Access Protection . 689<br>Direct Access. 695<br>Conclusion. 696<br>Index. 697</p>
<h1 id="Chapter-8-I-O-System-1"><a href="#Chapter-8-I-O-System-1" class="headerlink" title="Chapter 8 I/O System 1"></a>Chapter 8 I/O System 1</h1><p>I/O System Components. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1<br>The I/O Manager. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3<br>Typical I/O Processing. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4<br>Device Drivers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5<br>Types of Device Drivers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5<br>Structure of a Driver . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12<br>Driver Objects and Device Objects. . . . . . . . . . . . . . . . . . . . . . . . . . . . 14<br>Opening Devices . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19<br>I/O Processing. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25<br>Types of I/O. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25<br>I/O Request to a Single-Layered Driver. . . . . . . . . . . . . . . . . . . . . . . . 33<br>I/O Requests to Layered Drivers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40<br>I/O Cancellation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48<br>I/O Completion Ports . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 53<br>I/O Prioritization. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58<br>Container Notifications. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65<br>Driver Verifier. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65<br>Kernel-Mode Driver Framework (KMDF). . . . . . . . . . . . . . . . . . . . . . . . . . . . 68<br>Structure and Operation of a KMDF Driver. . . . . . . . . . . . . . . . . . . . . 68<br>KMDF Data Model. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70<br>KMDF I/O Model. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 74<br>User-Mode Driver Framework (UMDF). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78<br>The Plug and Play (PnP) Manager. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81<br>Level of Plug and Play Support. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 82<br>Driver Support for Plug and Play . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 82<br>Driver Loading, Initialization, and Installation . . . . . . . . . . . . . . . . . . 84<br>Driver Installation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 94<br>The Power Manager. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 98<br>Power Manager Operation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100<br>Driver Power Operation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 101<br>Driver and Application Control of Device Power. . . . . . . . . . . . . . . 105<br>Power Availability Requests. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 105<br>Processor Power Management (PPM). . . . . . . . . . . . . . . . . . . . . . . . 108<br>Conclusion. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123</p>
<h1 id="Chapter-9-Storage-Management-125"><a href="#Chapter-9-Storage-Management-125" class="headerlink" title="Chapter 9 Storage Management 125"></a>Chapter 9 Storage Management 125</h1><p>Storage Terminology. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 125<br>Disk Devices. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 126<br>Rotating Magnetic Disks. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 126<br>Solid State Disks. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 128<br>Disk Drivers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 131<br>Winload. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 132<br>Disk Class, Port, and Miniport Drivers. . . . . . . . . . . . . . . . . . . . . . . . 132<br>Disk Device Objects. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 136<br>Partition Manager. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 138<br>Volume Management. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 138<br>Basic Disks. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 139<br>Dynamic Disks. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 141<br>Multipartition Volume Management. . . . . . . . . . . . . . . . . . . . . . . . . 147<br>The Volume Namespace. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 153<br>Volume I/O Operations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 159<br>Virtual Disk Service. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 160<br>Virtual Hard Disk Support. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 162<br>Attaching VHDs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163<br>Nested File Systems. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163<br>BitLocker Drive Encryption. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163<br>Encryption Keys. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 165<br>Trusted Platform Module (TPM). . . . . . . . . . . . . . . . . . . . . . . . . . . . . 168<br>BitLocker Boot Process. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 170<br>BitLocker Key Recovery. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 172<br>Full-Volume Encryption Driver. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 173<br>BitLocker Management. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 174<br>BitLocker To Go . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 175<br>Volume Shadow Copy Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 177<br>Shadow Copies. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 177<br>VSS Architecture. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 177<br>VSS Operation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 178<br>Uses in Windows . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 181<br>Conclusion. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 186</p>
<h1 id="Chapter-10-Memory-Management-187"><a href="#Chapter-10-Memory-Management-187" class="headerlink" title="Chapter 10 Memory Management 187"></a>Chapter 10 Memory Management 187</h1><p>Introduction to the Memory Manager. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 187<br>Memory Manager Components. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 188<br>Internal Synchronization. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 189<br>Examining Memory Usage. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 190<br>Services Provided by the Memory Manager. . . . . . . . . . . . . . . . . . . . . . . . 193<br>Large and Small Pages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 193<br>Reserving and Committing Pages. . . . . . . . . . . . . . . . . . . . . . . . . . . . 195<br>Commit Limit . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 199<br>Locking Memory . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 199<br>Allocation Granularity. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 199<br>Shared Memory and Mapped Files. . . . . . . . . . . . . . . . . . . . . . . . . . . 200<br>Protecting Memory. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 203<br>No Execute Page Protection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 204<br>Copy-on-Write. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 209<br>Address Windowing Extensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 210<br>Kernel-Mode Heaps (System Memory Pools) . . . . . . . . . . . . . . . . . . . . . . . 212<br>Pool Sizes. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 213<br>Monitoring Pool Usage. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 215<br>Look-Aside Lists. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 219<br>Heap Manager. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 220<br>Types of Heaps. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 221<br>Heap Manager Structure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 222<br>Heap Synchronization. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 223<br>The Low Fragmentation Heap. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 223<br>Heap Security Features. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 224<br>Heap Debugging Features. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 225<br>Pageheap. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 226<br>Fault Tolerant Heap. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 227<br>Virtual Address Space Layouts. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 228<br>x86 Address Space Layouts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 229<br>x86 System Address Space Layout . . . . . . . . . . . . . . . . . . . . . . . . . . . 232<br>x86 Session Space . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 233<br>System Page Table Entries . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 235<br>64-Bit Address Space Layouts. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 237<br>x64 Virtual Addressing Limitations. . . . . . . . . . . . . . . . . . . . . . . . . . . 240<br>Dynamic System Virtual Address Space Management. . . . . . . . . . 242<br>System Virtual Address Space Quotas. . . . . . . . . . . . . . . . . . . . . . . . 245<br>User Address Space Layout . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 246<br>Address Translation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 251<br>x86 Virtual Address Translation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 252<br>Translation Look-Aside Buffer. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 259<br>Physical Address Extension (PAE). . . . . . . . . . . . . . . . . . . . . . . . . . . . 260<br>x64 Virtual Address Translation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 265<br>IA64 Virtual Address Translation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 266<br>Page Fault Handling. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 267<br>Invalid PTEs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 268<br>Prototype PTEs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 269<br>In-Paging I/O. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 271<br>Collided Page Faults . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 272<br>Clustered Page Faults . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 272<br>Page Files. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 273<br>Commit Charge and the System Commit Limit . . . . . . . . . . . . . . . . 275<br>Commit Charge and Page File Size. . . . . . . . . . . . . . . . . . . . . . . . . . . 278<br>Stacks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 279<br>User Stacks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 280<br>Kernel Stacks. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 281<br>DPC Stack . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 282<br>Virtual Address Descriptors. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 282<br>Process VADs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 283<br>Rotate VADs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 284<br>NUMA. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 285<br>Section Objects. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 286<br>Driver Verifier. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 292<br>Page Frame Number Database. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 297<br>Page List Dynamics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 300<br>Page Priority. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 310<br>Modified Page Writer. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 314<br>PFN Data Structures. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 315<br>Physical Memory Limits. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 320<br>Windows Client Memory Limits. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 321<br>Working Sets. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 324<br>Demand Paging. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 324<br>Logical Prefetcher . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 324<br>Placement Policy . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 328<br>Working Set Management. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 329<br>Balance Set Manager and Swapper . . . . . . . . . . . . . . . . . . . . . . . . . . 333<br>System Working Sets. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 334<br>Memory Notification Events . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 335<br>Proactive Memory Management (Superfetch) . . . . . . . . . . . . . . . . . . . . . . 338<br>Components. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 338<br>Tracing and Logging. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 341<br>Scenarios. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 342<br>Page Priority and Rebalancing. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 342<br>Robust Performance. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 344<br>ReadyBoost. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 346<br>ReadyDrive . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 348<br>Unified Caching. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 348<br>Process Reflection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 351<br>Conclusion. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 354</p>
<h1 id="Chapter-11-Cache-Manager-355"><a href="#Chapter-11-Cache-Manager-355" class="headerlink" title="Chapter 11 Cache Manager 355"></a>Chapter 11 Cache Manager 355</h1><p>Key Features of the Cache Manager. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 355<br>Single, Centralized System Cache. . . . . . . . . . . . . . . . . . . . . . . . . . . . 356<br>The Memory Manager . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 356<br>Cache Coherency. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 356<br>Virtual Block Caching . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 358<br>Stream-Based Caching. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 358<br>Recoverable File System Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . 359<br>Cache Virtual Memory Management. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 360<br>Cache Size. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .361<br>Cache Virtual Size. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 361<br>Cache Working Set Size . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 361<br>Cache Physical Size . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 363<br>Cache Data Structures. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 364<br>Systemwide Cache Data Structures. . . . . . . . . . . . . . . . . . . . . . . . . . . 365<br>Per-File Cache Data Structures . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 368<br>File System Interfaces. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 373<br>Copying to and from the Cache. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 374<br>Caching with the Mapping and Pinning Interfaces. . . . . . . . . . . . . 374<br>Caching with the Direct Memory Access Interfaces . . . . . . . . . . . . 375<br>Fast I/O. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 375<br>Read-Ahead and Write-Behind. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 377<br>Intelligent Read-Ahead. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 378<br>Write-Back Caching and Lazy Writing. . . . . . . . . . . . . . . . . . . . . . . . 379<br>Write Throttling. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 388<br>System Threads. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 390<br>Conclusion. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 390</p>
<h1 id="Chapter-12-File-Systems-391"><a href="#Chapter-12-File-Systems-391" class="headerlink" title="Chapter 12 File Systems 391"></a>Chapter 12 File Systems 391</h1><p>Windows File System Formats . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 392<br>CDFS. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 392<br>UDF. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 393<br>FAT12, FAT16, and FAT32 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 393<br>exFAT . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 396<br>NTFS. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 397<br>File System Driver Architecture . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 398<br>Local FSDs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 398<br>Remote FSDs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 400<br>File System Operation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 407<br>File System Filter Drivers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 413<br>Troubleshooting File System Problems. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 415<br>Process Monitor Basic vs. Advanced Modes. . . . . . . . . . . . . . . . . . . 415<br>Process Monitor Troubleshooting Techniques. . . . . . . . . . . . . . . . . 416<br>Common Log File System. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 416<br>NTFS Design Goals and Features. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 424<br>High-End File System Requirements. . . . . . . . . . . . . . . . . . . . . . . . . . 424<br>Advanced Features of NTFS. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 426<br>NTFS File System Driver. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 439<br>NTFS On-Disk Structure. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 442<br>Volumes. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 442<br>Clusters. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 442<br>Master File Table . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 443<br>File Record Numbers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 447<br>File Records. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 447<br>File Names. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 449<br>Resident and Nonresident Attributes. . . . . . . . . . . . . . . . . . . . . . . . . 453<br>Data Compression and Sparse Files. . . . . . . . . . . . . . . . . . . . . . . . . . 456<br>The Change Journal File. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 461<br>Indexing. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 464<br>Object IDs. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 466<br>Quota Tracking. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 466<br>Consolidated Security. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 467<br>Reparse Points . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 469<br>Transaction Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 469<br>NTFS Recovery Support. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 477<br>Design . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 478<br>Metadata Logging. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 479<br>Recovery . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 483<br>NTFS Bad-Cluster Recovery. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 487<br>Self-Healing. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 490<br>Encrypting File System Security. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 491<br>Encrypting a File for the First Time. . . . . . . . . . . . . . . . . . . . . . . . . . . 494<br>The Decryption Process . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 496<br>Backing Up Encrypted Files. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 497<br>Copying Encrypted Files. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 497<br>Conclusion. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 498</p>
<h1 id="Chapter-13-Startup-and-Shutdown-499"><a href="#Chapter-13-Startup-and-Shutdown-499" class="headerlink" title="Chapter 13 Startup and Shutdown 499"></a>Chapter 13 Startup and Shutdown 499</h1><p>Boot Process . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 499<br>BIOS Preboot. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .499<br>The BIOS Boot Sector and Bootmgr. . . . . . . . . . . . . . . . . . . . . . . . . . 502<br>The UEFI Boot Process. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 512<br>Booting from iSCSI. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 514<br>Initializing the Kernel and Executive Subsystems. . . . . . . . . . . . . . . 514<br>Smss, Csrss, and Wininit. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 522<br>ReadyBoot. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 527<br>Images That Start Automatically. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 528<br>Troubleshooting Boot and Startup Problems . . . . . . . . . . . . . . . . . . . . . . . 529<br>Last Known Good. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 530<br>Safe Mode. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 530<br>Windows Recovery Environment (WinRE). . . . . . . . . . . . . . . . . . . . . 534<br>Solving Common Boot Problems. . . . . . . . . . . . . . . . . . . . . . . . . . . . 537<br>Shutdown. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 542<br>Conclusion. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 545</p>
<h1 id="Chapter-14-Crash-Dump-Analysis-547"><a href="#Chapter-14-Crash-Dump-Analysis-547" class="headerlink" title="Chapter 14 Crash Dump Analysis 547"></a>Chapter 14 Crash Dump Analysis 547</h1><p>Why Does Windows Crash?. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 547<br>The Blue Screen. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 548<br>Causes of Windows Crashes. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 549<br>Troubleshooting Crashes. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 551<br>Crash Dump Files. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .553<br>Crash Dump Generation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 559<br>Windows Error Reporting. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 561<br>Online Crash Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 563<br>Basic Crash Dump Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 564<br>Notmyfault. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 564<br>Basic Crash Dump Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 565<br>Verbose Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 567<br>Using Crash Troubleshooting Tools. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 569<br>Buffer Overruns, Memory Corruption, and Special Pool . . . . . . . . 569<br>Code Overwrite and System Code Write Protection. . . . . . . . . . . . 573<br>Advanced Crash Dump Analysis. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 574<br>Stack Trashes. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 575<br>Hung or Unresponsive Systems. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 577<br>When There Is No Crash Dump. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 581<br>Analysis of Common Stop Codes. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 585<br>0xD1 - DRIVER_IRQL_NOT_LESS_OR_EQUAL. . . . . . . . . . . . . . . . . . 585<br>0x8E - KERNEL_MODE_EXCEPTION_NOT_HANDLED. . . . . . . . . . . 586<br>0x7F - UNEXPECTED_KERNEL_MODE_TRAP. . . . . . . . . . . . . . . . . . . 588<br>0xC5 - DRIVER_CORRUPTED_EXPOOL. . . . . . . . . . . . . . . . . . . . . . . . 590<br>Hardware Malfunctions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 593<br>Conclusion. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 594</p>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">theForger</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2017/11/16/programer/" class="pre-post btn btn-default" title='programer'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">programer</span>
        </a>
    
    
        <a href="/2017/11/16/Programming-Windows/" class="next-post btn btn-default" title='Programming Windows'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Programming Windows</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
  <script id="dsq-count-scr" src="https://israel-liu.disqus.com/count.js" async></script>


<script type="text/javascript">
  var disqus_config = function () {
    this.page.url = 'https://israel-liu.github.io/2017/11/16/Windows-Internals/';
    this.page.identifier = '2017/11/16/Windows-Internals/';
    this.page.title = 'Windows Internals';
  };
  var d = document, s = d.createElement('script');
  s.src = 'https://israel-liu.disqus.com/embed.js';
  s.setAttribute('data-timestamp', '' + +new Date());
  (d.head || d.body).appendChild(s);
</script>


	

    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-1-Concepts-and-Tools-1"><span class="toc-text">Chapter 1 Concepts and Tools 1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Operating-System-Versions-1"><span class="toc-text">Windows Operating System Versions. 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Foundation-Concepts-and-Terms-2"><span class="toc-text">Foundation Concepts and Terms. 2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-API-2"><span class="toc-text">Windows API. 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Services-Functions-and-Routines-4"><span class="toc-text">Services, Functions, and Routines. 4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Processes-Threads-and-Jobs-5"><span class="toc-text">Processes, Threads, and Jobs. 5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Virtual-Memory-15"><span class="toc-text">Virtual Memory . 15</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kernel-Mode-vs-User-Mode-17"><span class="toc-text">Kernel Mode vs. User Mode. 17</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Terminal-Services-and-Multiple-Sessions-20"><span class="toc-text">Terminal Services and Multiple Sessions. 20</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Objects-and-Handles-21"><span class="toc-text">Objects and Handles. 21</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Security-22"><span class="toc-text">Security . 22</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Registry-23"><span class="toc-text">Registry . 23</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicode-24"><span class="toc-text">Unicode. 24</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Digging-into-Windows-Internals-24"><span class="toc-text">Digging into Windows Internals. 24</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Performance-Monitor-25"><span class="toc-text">Performance Monitor. 25</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kernel-Debugging-26"><span class="toc-text">Kernel Debugging. 26</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-Software-Development-Kit-31"><span class="toc-text">Windows Software Development Kit. 31</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-Driver-Kit-31"><span class="toc-text">Windows Driver Kit . 31</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sysinternals-Tools-32"><span class="toc-text">Sysinternals Tools. 32</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion-32"><span class="toc-text">Conclusion. 32</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-2-System-Architecture-33"><span class="toc-text">Chapter 2 System Architecture 33</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Requirements-and-Design-Goals-33"><span class="toc-text">Requirements and Design Goals . 33</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Operating-System-Model-34"><span class="toc-text">Operating System Model. 34</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Architecture-Overview-35"><span class="toc-text">Architecture Overview. 35</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Portability-37"><span class="toc-text">Portability. 37</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Symmetric-Multiprocessing-38"><span class="toc-text">Symmetric Multiprocessing. 38</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scalability-40"><span class="toc-text">Scalability. 40</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Differences-Between-Client-and-Server-Versions-41"><span class="toc-text">Differences Between Client and Server Versions. 41</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Checked-Build-45"><span class="toc-text">Checked Build. 45</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Key-System-Components-46"><span class="toc-text">Key System Components. 46</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Environment-Subsystems-and-Subsystem-DLLs-48"><span class="toc-text">Environment Subsystems and Subsystem DLLs . 48</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ntdll-dll-53"><span class="toc-text">Ntdll.dll. 53</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Executive-54"><span class="toc-text">Executive. 54</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kernel-57"><span class="toc-text">Kernel. 57</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hardware-Abstraction-Layer-60"><span class="toc-text">Hardware Abstraction Layer. 60</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Device-Drivers-63"><span class="toc-text">Device Drivers. 63</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#System-Processes-68"><span class="toc-text">System Processes. 68</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion-78"><span class="toc-text">Conclusion. 78</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-3-System-Mechanisms-79"><span class="toc-text">Chapter 3 System Mechanisms 79</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-4-Management-Mechanisms-277"><span class="toc-text">Chapter 4 Management Mechanisms 277</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-5-Processes-Threads-and-Jobs-359"><span class="toc-text">Chapter 5 Processes, Threads, and Jobs 359</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Process-Internals-359"><span class="toc-text">Process Internals. 359</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-Structures-359"><span class="toc-text">Data Structures. 359</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Protected-Processes-368"><span class="toc-text">Protected Processes. 368</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-6-Security-487"><span class="toc-text">Chapter 6 Security 487</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-7-Networking-591"><span class="toc-text">Chapter 7 Networking 591</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-8-I-O-System-1"><span class="toc-text">Chapter 8 I/O System 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-9-Storage-Management-125"><span class="toc-text">Chapter 9 Storage Management 125</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-10-Memory-Management-187"><span class="toc-text">Chapter 10 Memory Management 187</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-11-Cache-Manager-355"><span class="toc-text">Chapter 11 Cache Manager 355</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-12-File-Systems-391"><span class="toc-text">Chapter 12 File Systems 391</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-13-Startup-and-Shutdown-499"><span class="toc-text">Chapter 13 Startup and Shutdown 499</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-14-Crash-Dump-Analysis-547"><span class="toc-text">Chapter 14 Crash Dump Analysis 547</span></a></li></ol>
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<!--<a id="toc-btn">
    <i class="fa fa-bars"></i>
</a>-->

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



	<script src="/js/search.js?rev=@@hash"></script>


<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>